<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conjugar â€” A1/A2</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#2D5016">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #F7F5F2;
    --surface: #FFFFFF;
    --border: #E8E4DF;
    --text: #1A1714;
    --text-muted: #8C8580;
    --accent: #2D5016;
    --accent-light: #EBF2E3;
    --accent2: #C85A1B;
    --irreg: #C85A1B;
    --irreg-bg: #FDF0E8;
    --a1: #2D5016;
    --a2: #1A4A6B;
    --a2-bg: #E8F2F8;
    --shadow: 0 2px 16px rgba(26,23,20,0.07);
    --radius: 16px;
    --transition: 0.3s cubic-bezier(0.4,0,0.2,1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* NAV */
  nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 32px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .nav-logo {
    font-family: 'DM Serif Display', serif;
    font-size: 22px;
    color: var(--accent);
    letter-spacing: -0.5px;
  }
  .nav-tabs {
    display: flex;
    gap: 4px;
    background: var(--bg);
    border-radius: 10px;
    padding: 4px;
  }
  .nav-tab {
    padding: 7px 18px;
    border-radius: 7px;
    border: none;
    background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-muted);
    cursor: pointer;
    transition: var(--transition);
  }
  .nav-tab.active {
    background: var(--surface);
    color: var(--text);
    box-shadow: var(--shadow);
  }
  .nav-right { width: 120px; display: flex; justify-content: flex-end; }

  /* PAGES */
  .page { display: none; flex: 1; }
  .page.active { display: flex; flex-direction: column; }

  /* ======= PRACTICE PAGE ======= */
  #page-practice {
    align-items: center;
    padding: 40px 24px;
    gap: 24px;
  }

  /* Category bar */
  .category-bar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 760px;
    width: 100%;
  }
  .cat-btn {
    padding: 6px 14px;
    border-radius: 20px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-muted);
    cursor: pointer;
    transition: var(--transition);
  }
  .cat-btn:hover { border-color: var(--accent); color: var(--accent); }
  .cat-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  /* Main card */
  .card-wrap {
    max-width: 520px;
    width: 100%;
    perspective: 1000px;
  }
  .card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    padding: 48px 40px 40px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
    min-height: 280px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    position: relative;
    user-select: none;
  }
  .card:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(26,23,20,0.1); }
  .card:active { transform: translateY(0); }

  .card-stage-label {
    position: absolute;
    top: 16px;
    left: 20px;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 0.3px;
    color: var(--text-muted);
  }

  .card-sound-btn {
    position: absolute;
    top: 12px;
    right: 16px;
    width: 34px;
    height: 34px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--bg);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    font-size: 16px;
  }
  .card-sound-btn:hover { background: var(--accent-light); border-color: var(--accent); }

  .pronoun-badge {
    font-family: 'DM Serif Display', serif;
    font-size: 22px;
    font-weight: 400;
    font-style: italic;
    color: var(--text-muted);
    background: var(--bg);
    border-radius: 8px;
    padding: 5px 14px;
    letter-spacing: -0.3px;
  }

  .card-infinitive {
    font-family: 'DM Serif Display', serif;
    font-size: 42px;
    color: var(--text);
    line-height: 1.1;
    letter-spacing: -1px;
  }

  .card-meaning {
    font-size: 14px;
    color: var(--text-muted);
    font-weight: 400;
  }

  .card-level-badge {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.5px;
    padding: 3px 9px;
    border-radius: 5px;
  }
  .level-a1 { background: var(--accent-light); color: var(--accent); }
  .level-a2 { background: var(--a2-bg); color: var(--a2); }

  /* Answer state */
  .card-answer {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    width: 100%;
  }
  .card.revealed .card-answer { display: flex; }
  .card.revealed .card-pre-reveal { display: none; }
  .card-pre-reveal { display: flex; flex-direction: column; align-items: center; gap: 12px; }

  .conjugated-form {
    font-family: 'DM Serif Display', serif;
    font-size: 52px;
    color: var(--accent);
    letter-spacing: -1.5px;
    line-height: 1.0;
  }
  .conjugated-form.irregular {
    color: var(--irreg);
  }

  .irreg-tag {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.5px;
    color: var(--irreg);
    background: var(--irreg-bg);
    border-radius: 5px;
    padding: 3px 8px;
  }

  .click-hint {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 8px;
    opacity: 0.7;
  }

  /* Card bottom row â€” prev/next nav buttons */
  .card-controls {
    max-width: 520px;
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
  }
  .nav-arrow-btn {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 1.5px solid var(--border);
    background: var(--surface);
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    color: var(--text-muted);
    flex-shrink: 0;
    box-shadow: var(--shadow);
  }
  .nav-arrow-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: var(--accent-light);
    transform: scale(1.05);
  }
  .nav-arrow-btn:active { transform: scale(0.96); }

  .progress-wrap {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .progress-bar {
    flex: 1;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
    min-width: 80px;
  }
  .progress-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 0.4s ease;
  }
  .progress-count {
    font-size: 12px;
    color: var(--text-muted);
    white-space: nowrap;
  }

  /* ======= REFERENCE PAGE ======= */
  #page-reference {
    padding: 40px 32px;
    align-items: center;
  }
  .ref-container {
    max-width: 860px;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 32px;
  }
  .ref-header {
    font-family: 'DM Serif Display', serif;
    font-size: 30px;
    color: var(--text);
    letter-spacing: -0.5px;
  }
  .ref-subtitle {
    font-size: 14px;
    color: var(--text-muted);
    margin-top: 4px;
  }

  .tense-block {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }
  .tense-block-header {
    padding: 18px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .tense-name {
    font-weight: 600;
    font-size: 16px;
  }
  .tense-level {
    font-size: 11px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 5px;
  }
  .tense-block-body {
    padding: 20px 24px;
  }
  .tense-desc {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 16px;
    line-height: 1.6;
  }

  .endings-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 16px;
  }
  .ending-group {
    background: var(--bg);
    border-radius: 10px;
    padding: 14px;
  }
  .ending-group-title {
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 8px;
  }
  .ending-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 3px 0;
    font-size: 13px;
  }
  .ending-pron { color: var(--text-muted); }
  .ending-end {
    font-weight: 600;
    font-family: 'DM Serif Display', serif;
    font-size: 15px;
    color: var(--accent);
  }
  .ending-end.irreg-ending { color: var(--irreg); }

  .example-verb {
    font-size: 13px;
    color: var(--text-muted);
  }
  .example-verb span { color: var(--text); font-weight: 500; }

  /* ======= SETTINGS PAGE ======= */
  #page-settings {
    padding: 40px 32px;
    align-items: center;
  }
  .settings-container {
    max-width: 600px;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }
  .settings-header {
    font-family: 'DM Serif Display', serif;
    font-size: 30px;
    color: var(--text);
  }
  .settings-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }
  .settings-section-title {
    padding: 14px 20px;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border);
    background: var(--bg);
  }
  .settings-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    gap: 16px;
  }
  .settings-row:last-child { border-bottom: none; }
  .settings-row-label { font-size: 14px; font-weight: 500; }
  .settings-row-sub { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

  /* Toggle */
  .toggle {
    position: relative;
    width: 44px;
    height: 24px;
    flex-shrink: 0;
  }
  .toggle input { opacity: 0; width: 0; height: 0; }
  .toggle-slider {
    position: absolute;
    inset: 0;
    background: var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition);
  }
  .toggle-slider:before {
    content: '';
    position: absolute;
    width: 18px;
    height: 18px;
    left: 3px;
    top: 3px;
    background: white;
    border-radius: 50%;
    transition: var(--transition);
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  }
  input:checked + .toggle-slider { background: var(--accent); }
  input:checked + .toggle-slider:before { transform: translateX(20px); }

  /* Checkbox group */
  .checkbox-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    padding: 16px 20px;
  }
  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    padding: 8px 10px;
    border-radius: 8px;
    transition: var(--transition);
  }
  .checkbox-item:hover { background: var(--bg); }
  .checkbox-item input { display: none; }
  .checkbox-box {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border);
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: var(--transition);
  }
  .checkbox-item input:checked ~ .checkbox-box {
    background: var(--accent);
    border-color: var(--accent);
  }
  .checkbox-item input:checked ~ .checkbox-box::after {
    content: 'âœ“';
    color: white;
    font-size: 11px;
    font-weight: 700;
  }
  .checkbox-label { font-size: 13px; font-weight: 500; }
  .checkbox-sublabel { font-size: 11px; color: var(--text-muted); }

  /* Animate card flip */
  @keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-in { animation: fadeSlideUp 0.28s ease forwards; }

  @keyframes pulse {
    0%,100% { opacity: 1; } 50% { opacity: 0.5; }
  }
  .speaking { animation: pulse 0.6s ease infinite; }

  .lang-option-btn {
    padding: 8px 20px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--surface);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-muted);
    cursor: pointer;
    transition: var(--transition);
  }
  .lang-option-btn:hover { border-color: var(--accent); color: var(--accent); }
  .lang-option-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }
</style>
</head>
<body>

<nav>
  <div class="nav-logo">conjugar</div>
  <div class="nav-tabs">
    <button class="nav-tab active" id="nav-practice" onclick="showPage('practice')">Practice</button>
    <button class="nav-tab" id="nav-reference" onclick="showPage('reference')">Grammar</button>
    <button class="nav-tab" id="nav-settings" onclick="showPage('settings')">Settings</button>
  </div>
  <div class="nav-right"></div>
</nav>

<!-- ====== PRACTICE PAGE ====== -->
<div id="page-practice" class="page active">

  <div class="category-bar" id="categoryBar"></div>

  <div class="card-wrap">
    <div class="card" id="mainCard" onclick="handleCardClick()">
      <div class="card-stage-label" id="stageLabel">Presente</div>
      <button class="card-sound-btn" id="soundBtn" onclick="event.stopPropagation(); speakCurrent()" title="æœ—è¯»">ğŸ”Š</button>

      <div class="card-pre-reveal" id="preReveal">
        <div class="pronoun-badge" id="pronounBadge">yo</div>
        <div class="card-infinitive" id="infinitiveDisplay">hablar</div>
        <div class="card-meaning" id="meaningDisplay">to speak Â· è¯´/è®²è¯</div>
        <div class="card-level-badge" id="levelBadge">A1</div>
        <div class="click-hint" data-i18n="hint_reveal">ç‚¹å‡»æŸ¥çœ‹å˜ä½ Â· å†æ¬¡ç‚¹å‡»ä¸‹ä¸€é¢˜</div>
      </div>

      <div class="card-answer" id="answerReveal">
        <div class="pronoun-badge" id="answerPronoun">yo</div>
        <div class="conjugated-form" id="conjugatedForm">hablo</div>
        <div class="irreg-tag" id="irregTag" style="display:none" data-i18n="irregular_tag">ä¸è§„åˆ™ âš¡</div>
        <div class="card-meaning" id="answerMeaning">to speak Â· è¯´/è®²è¯</div>
        <div class="click-hint" style="margin-top:4px" data-i18n="hint_next">å†æ¬¡ç‚¹å‡»ä¸‹ä¸€é¢˜</div>
      </div>
    </div>
  </div>

  <div class="card-controls">
    <button class="nav-arrow-btn" onclick="prevCard()" title="ä¸Šä¸€ä¸ª">â†</button>
    <div class="progress-wrap" style="flex:1">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-count" id="progressCount">0 / 0</div>
    </div>
    <button class="nav-arrow-btn" onclick="nextCard()" title="ä¸‹ä¸€ä¸ª">â†’</button>
  </div>

</div>

<!-- ====== REFERENCE PAGE ====== -->
<div id="page-reference" class="page">
<div class="ref-container" id="refContainer">
  <!-- Rendered by buildReference() -->
</div>
</div>

<!-- ====== SETTINGS PAGE ====== -->
<div id="page-settings" class="page">
<div class="settings-container">
  <div class="settings-header" data-i18n="settings_title">è®¾ç½®</div>

  <div class="settings-section">
    <div class="settings-section-title" data-i18n="settings_tenses">æ—¶æ€é€‰æ‹©</div>
    <div class="checkbox-grid" id="tenseCheckboxes"></div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title" data-i18n="settings_pronouns">äººç§°ä»£è¯</div>
    <div class="checkbox-grid" id="pronounCheckboxes"></div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title" data-i18n="settings_level">è¯æ±‡çº§åˆ«</div>
    <div class="checkbox-grid" id="levelCheckboxes">
      <label class="checkbox-item">
        <input type="checkbox" id="levelA1" checked onchange="toggleVerbLevel('A1', this.checked)">
        <span class="checkbox-box"></span>
        <div>
          <div class="checkbox-label">A1</div>
          <div class="checkbox-sublabel" data-i18n="level_a1_sub">åŸºç¡€çº§åˆ«åŠ¨è¯</div>
        </div>
      </label>
      <label class="checkbox-item">
        <input type="checkbox" id="levelA2" checked onchange="toggleVerbLevel('A2', this.checked)">
        <span class="checkbox-box"></span>
        <div>
          <div class="checkbox-label">A2</div>
          <div class="checkbox-sublabel" data-i18n="level_a2_sub">è¿›é˜¶çº§åˆ«åŠ¨è¯</div>
        </div>
      </label>
    </div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title" data-i18n="settings_irreg">å˜åŒ–ç±»å‹</div>
    <div style="display:flex; flex-direction:column; gap:0">
      <label class="checkbox-item" style="padding:14px 20px; border-bottom:1px solid var(--border)">
        <input type="radio" name="irregFilter" value="all" checked onchange="setIrregFilter('all')" style="display:none">
        <span class="checkbox-box" id="rb-all" style="border-radius:50%">âœ“</span>
        <div>
          <div class="checkbox-label" data-i18n="irreg_all">å…¨éƒ¨</div>
          <div class="checkbox-sublabel" data-i18n="irreg_all_sub">è§„åˆ™ + ä¸è§„åˆ™</div>
        </div>
      </label>
      <label class="checkbox-item" style="padding:14px 20px; border-bottom:1px solid var(--border)">
        <input type="radio" name="irregFilter" value="regular" onchange="setIrregFilter('regular')" style="display:none">
        <span class="checkbox-box" id="rb-regular" style="border-radius:50%"></span>
        <div>
          <div class="checkbox-label" data-i18n="irreg_regular">åªç»ƒè§„åˆ™å˜åŒ–</div>
          <div class="checkbox-sublabel" data-i18n="irreg_regular_sub">è¯å°¾æŒ‰æ ‡å‡†è§„åˆ™å˜ä½çš„å½¢å¼</div>
        </div>
      </label>
      <label class="checkbox-item" style="padding:14px 20px">
        <input type="radio" name="irregFilter" value="irregular" onchange="setIrregFilter('irregular')" style="display:none">
        <span class="checkbox-box" id="rb-irregular" style="border-radius:50%"></span>
        <div>
          <div class="checkbox-label" data-i18n="irreg_irregular">åªç»ƒä¸è§„åˆ™å˜åŒ–</div>
          <div class="checkbox-sublabel" data-i18n="irreg_irregular_sub">æœ‰ç‰¹æ®Šå˜ä½çš„å½¢å¼ï¼ˆæ©™è‰²æ ‡æ³¨ï¼‰</div>
        </div>
      </label>
    </div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title" data-i18n="settings_speech">æœ—è¯»</div>
    <div class="settings-row">
      <div>
        <div class="settings-row-label" data-i18n="speech_auto">è‡ªåŠ¨æœ—è¯» Infinitivo</div>
        <div class="settings-row-sub" data-i18n="speech_auto_sub">ç¿»åˆ°æ–°å¡ç‰‡æ—¶è‡ªåŠ¨æœ—è¯»åŠ¨è¯åŸå½¢</div>
      </div>
      <label class="toggle">
        <input type="checkbox" id="toggleAutoSpeak" checked>
        <span class="toggle-slider"></span>
      </label>
    </div>
    <div class="settings-row">
      <div>
        <div class="settings-row-label" data-i18n="speech_answer">æœ—è¯»å˜ä½ç»“æœ</div>
        <div class="settings-row-sub" data-i18n="speech_answer_sub">ç¿»å¼€ç­”æ¡ˆæ—¶è‡ªåŠ¨æœ—è¯»å˜ä½åçš„å½¢å¼</div>
      </div>
      <label class="toggle">
        <input type="checkbox" id="toggleSpeakAnswer">
        <span class="toggle-slider"></span>
      </label>
    </div>
  </div>

  <div class="settings-section">
    <div class="settings-section-title" data-i18n="settings_lang">ç•Œé¢è¯­è¨€</div>
    <div style="display:flex; gap:10px; padding:16px 20px;">
      <button class="lang-option-btn" id="lopt-zh" onclick="setLang('zh')">ä¸­æ–‡</button>
      <button class="lang-option-btn active" id="lopt-en" onclick="setLang('en')">English</button>
    </div>
  </div>

</div>
</div>

<script>
// ============================================================
// DATA
// ============================================================
const TENSES = [
  { id: 'presente', name: 'Presente', level: 'A1', label: 'ç°åœ¨æ—¶ (A1)' },
  { id: 'perfecto', name: 'PretÃ©rito Perfecto', level: 'A2', label: 'è¿‘è¿‡å»æ—¶ (A2)' },
  { id: 'indefinido', name: 'PretÃ©rito Indefinido', level: 'A2', label: 'ç®€å•è¿‡å»æ—¶ (A2)' },
  { id: 'futuro', name: 'Futuro PrÃ³ximo', level: 'A1', label: 'è¿‘å°†æ¥ (A1)' },
  { id: 'reflexivo', name: 'Reflexivo (Pres.)', level: 'A1', label: 'åèº«åŠ¨è¯ç°åœ¨æ—¶ (A1)' },
  { id: 'imperativo', name: 'Imperativo', level: 'A2', label: 'å‘½ä»¤å¼ (A2)' },
];

const PRONOUNS = ['yo','tÃº','Ã©l/ella','nosotros','vosotros','ellos/ellas'];

const CATEGORIES = ['å…¨éƒ¨','æ—¥å¸¸åŠ¨è¯','é¥®é£Ÿ','è´­ç‰©','èŒä¸š','çˆ±å¥½','èº«ä½“/å¥åº·','å­¦ä¹ ','ç§»åŠ¨/äº¤é€š'];

// Each verb: { inf, en, zh, cat, level, forms: { presente, perfecto, indefinido, futuro }, irregular: { presente: [indices], ... } }
// irregular: array of pronoun indices that are irregular (0=yo,1=tÃº,2=Ã©l,3=nosotros,4=vosotros,5=ellos)
const VERBS = [
  // ---- æ—¥å¸¸åŠ¨è¯ ----
  {inf:'ser', en:'to be (permanent)', zh:'æ˜¯ï¼ˆæ°¸ä¹…ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['soy','eres','es','somos','sois','son'],
      perfecto:['he sido','has sido','ha sido','hemos sido','habÃ©is sido','han sido'],
      indefinido:['fui','fuiste','fue','fuimos','fuisteis','fueron'],
      futuro:['voy a ser','vas a ser','va a ser','vamos a ser','vais a ser','van a ser']
    }, irregular:{presente:[0,1,2,3,4,5], indefinido:[0,1,2,3,4,5]}},

  {inf:'estar', en:'to be (state/location)', zh:'æ˜¯/åœ¨ï¼ˆä¸´æ—¶ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['estoy','estÃ¡s','estÃ¡','estamos','estÃ¡is','estÃ¡n'],
      perfecto:['he estado','has estado','ha estado','hemos estado','habÃ©is estado','han estado'],
      indefinido:['estuve','estuviste','estuvo','estuvimos','estuvisteis','estuvieron'],
      futuro:['voy a estar','vas a estar','va a estar','vamos a estar','vais a estar','van a estar']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[0,1,2,3,4,5]}},

  {inf:'tener', en:'to have', zh:'æœ‰/æ‹¥æœ‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['tengo','tienes','tiene','tenemos','tenÃ©is','tienen'],
      perfecto:['he tenido','has tenido','ha tenido','hemos tenido','habÃ©is tenido','han tenido'],
      indefinido:['tuve','tuviste','tuvo','tuvimos','tuvisteis','tuvieron'],
      futuro:['voy a tener','vas a tener','va a tener','vamos a tener','vais a tener','van a tener']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[0,1,2,3,4,5]}},

  {inf:'hacer', en:'to do / to make', zh:'åš/åˆ¶ä½œ', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['hago','haces','hace','hacemos','hacÃ©is','hacen'],
      perfecto:['he hecho','has hecho','ha hecho','hemos hecho','habÃ©is hecho','han hecho'],
      indefinido:['hice','hiciste','hizo','hicimos','hicisteis','hicieron'],
      futuro:['voy a hacer','vas a hacer','va a hacer','vamos a hacer','vais a hacer','van a hacer']
    }, irregular:{presente:[0], indefinido:[0,1,2,3,4,5]}},

  {inf:'ir', en:'to go', zh:'å»', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['voy','vas','va','vamos','vais','van'],
      perfecto:['he ido','has ido','ha ido','hemos ido','habÃ©is ido','han ido'],
      indefinido:['fui','fuiste','fue','fuimos','fuisteis','fueron'],
      futuro:['voy a ir','vas a ir','va a ir','vamos a ir','vais a ir','van a ir']
    }, irregular:{presente:[0,1,2,3,4,5], indefinido:[0,1,2,3,4,5]}},

  {inf:'venir', en:'to come', zh:'æ¥', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['vengo','vienes','viene','venimos','venÃ­s','vienen'],
      perfecto:['he venido','has venido','ha venido','hemos venido','habÃ©is venido','han venido'],
      indefinido:['vine','viniste','vino','vinimos','vinisteis','vinieron'],
      futuro:['voy a venir','vas a venir','va a venir','vamos a venir','vais a venir','van a venir']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[0,1,2,3,4,5]}},

  {inf:'querer', en:'to want / to love', zh:'æƒ³è¦/çˆ±', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['quiero','quieres','quiere','queremos','querÃ©is','quieren'],
      perfecto:['he querido','has querido','ha querido','hemos querido','habÃ©is querido','han querido'],
      indefinido:['quise','quisiste','quiso','quisimos','quisisteis','quisieron'],
      futuro:['voy a querer','vas a querer','va a querer','vamos a querer','vais a querer','van a querer']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[0,1,2,3,4,5]}},

  {inf:'poder', en:'can / to be able to', zh:'èƒ½/å¯ä»¥', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['puedo','puedes','puede','podemos','podÃ©is','pueden'],
      perfecto:['he podido','has podido','ha podido','hemos podido','habÃ©is podido','han podido'],
      indefinido:['pude','pudiste','pudo','pudimos','pudisteis','pudieron'],
      futuro:['voy a poder','vas a poder','va a poder','vamos a poder','vais a poder','van a poder']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[0,1,2,3,4,5]}},

  {inf:'saber', en:'to know (facts)', zh:'çŸ¥é“/ä¼š', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['sÃ©','sabes','sabe','sabemos','sabÃ©is','saben'],
      perfecto:['he sabido','has sabido','ha sabido','hemos sabido','habÃ©is sabido','han sabido'],
      indefinido:['supe','supiste','supo','supimos','supisteis','supieron'],
      futuro:['voy a saber','vas a saber','va a saber','vamos a saber','vais a saber','van a saber']
    }, irregular:{presente:[0], indefinido:[0,1,2,3,4,5]}},

  {inf:'decir', en:'to say / to tell', zh:'è¯´/å‘Šè¯‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['digo','dices','dice','decimos','decÃ­s','dicen'],
      perfecto:['he dicho','has dicho','ha dicho','hemos dicho','habÃ©is dicho','han dicho'],
      indefinido:['dije','dijiste','dijo','dijimos','dijisteis','dijeron'],
      futuro:['voy a decir','vas a decir','va a decir','vamos a decir','vais a decir','van a decir']
    }, irregular:{presente:[0,2,5], indefinido:[0,1,2,3,4,5]}},

  {inf:'dar', en:'to give', zh:'ç»™', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['doy','das','da','damos','dais','dan'],
      perfecto:['he dado','has dado','ha dado','hemos dado','habÃ©is dado','han dado'],
      indefinido:['di','diste','dio','dimos','disteis','dieron'],
      futuro:['voy a dar','vas a dar','va a dar','vamos a dar','vais a dar','van a dar']
    }, irregular:{presente:[0], indefinido:[0,2]}},

  {inf:'poner', en:'to put / to place', zh:'æ”¾/æ”¾ç½®', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['pongo','pones','pone','ponemos','ponÃ©is','ponen'],
      perfecto:['he puesto','has puesto','ha puesto','hemos puesto','habÃ©is puesto','han puesto'],
      indefinido:['puse','pusiste','puso','pusimos','pusisteis','pusieron'],
      futuro:['voy a poner','vas a poner','va a poner','vamos a poner','vais a poner','van a poner']
    }, irregular:{presente:[0], indefinido:[0,1,2,3,4,5]}},

  {inf:'ver', en:'to see / to watch', zh:'çœ‹/çœ‹è§', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['veo','ves','ve','vemos','veis','ven'],
      perfecto:['he visto','has visto','ha visto','hemos visto','habÃ©is visto','han visto'],
      indefinido:['vi','viste','vio','vimos','visteis','vieron'],
      futuro:['voy a ver','vas a ver','va a ver','vamos a ver','vais a ver','van a ver']
    }, irregular:{presente:[0], indefinido:[0,2]}},

  {inf:'llamarse', en:'to be called / named', zh:'å«åš', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['me llamo','te llamas','se llama','nos llamamos','os llamÃ¡is','se llaman'],
      perfecto:['me he llamado','te has llamado','se ha llamado','nos hemos llamado','os habÃ©is llamado','se han llamado'],
      indefinido:['me llamÃ©','te llamaste','se llamÃ³','nos llamamos','os llamasteis','se llamaron'],
      futuro:['me voy a llamar','te vas a llamar','se va a llamar','nos vamos a llamar','os vais a llamar','se van a llamar']
    }, irregular:{}},

  {inf:'gustar', en:'to like', zh:'å–œæ¬¢', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['me gusta','te gusta','le gusta','nos gusta','os gusta','les gusta'],
      perfecto:['me ha gustado','te ha gustado','le ha gustado','nos ha gustado','os ha gustado','les ha gustado'],
      indefinido:['me gustÃ³','te gustÃ³','le gustÃ³','nos gustÃ³','os gustÃ³','les gustÃ³'],
      futuro:['me va a gustar','te va a gustar','le va a gustar','nos va a gustar','os va a gustar','les va a gustar']
    }, irregular:{}},

  {inf:'vivir', en:'to live', zh:'ä½/ç”Ÿæ´»', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['vivo','vives','vive','vivimos','vivÃ­s','viven'],
      perfecto:['he vivido','has vivido','ha vivido','hemos vivido','habÃ©is vivido','han vivido'],
      indefinido:['vivÃ­','viviste','viviÃ³','vivimos','vivisteis','vivieron'],
      futuro:['voy a vivir','vas a vivir','va a vivir','vamos a vivir','vais a vivir','van a vivir']
    }, irregular:{}},

  // ---- é¥®é£Ÿ ----
  {inf:'comer', en:'to eat', zh:'åƒ', cat:'é¥®é£Ÿ', level:'A1',
    forms:{
      presente:['como','comes','come','comemos','comÃ©is','comen'],
      perfecto:['he comido','has comido','ha comido','hemos comido','habÃ©is comido','han comido'],
      indefinido:['comÃ­','comiste','comiÃ³','comimos','comisteis','comieron'],
      futuro:['voy a comer','vas a comer','va a comer','vamos a comer','vais a comer','van a comer']
    }, irregular:{}},

  {inf:'beber', en:'to drink', zh:'å–', cat:'é¥®é£Ÿ', level:'A1',
    forms:{
      presente:['bebo','bebes','bebe','bebemos','bebÃ©is','beben'],
      perfecto:['he bebido','has bebido','ha bebido','hemos bebido','habÃ©is bebido','han bebido'],
      indefinido:['bebÃ­','bebiste','bebiÃ³','bebimos','bebisteis','bebieron'],
      futuro:['voy a beber','vas a beber','va a beber','vamos a beber','vais a beber','van a beber']
    }, irregular:{}},

  {inf:'cocinar', en:'to cook', zh:'åšé¥­', cat:'é¥®é£Ÿ', level:'A1',
    forms:{
      presente:['cocino','cocinas','cocina','cocinamos','cocinÃ¡is','cocinan'],
      perfecto:['he cocinado','has cocinado','ha cocinado','hemos cocinado','habÃ©is cocinado','han cocinado'],
      indefinido:['cocinÃ©','cocinaste','cocinÃ³','cocinamos','cocinasteis','cocinaron'],
      futuro:['voy a cocinar','vas a cocinar','va a cocinar','vamos a cocinar','vais a cocinar','van a cocinar']
    }, irregular:{}},

  {inf:'pedir', en:'to order / to ask for', zh:'ç‚¹é¤/è¦æ±‚', cat:'é¥®é£Ÿ', level:'A1',
    forms:{
      presente:['pido','pides','pide','pedimos','pedÃ­s','piden'],
      perfecto:['he pedido','has pedido','ha pedido','hemos pedido','habÃ©is pedido','han pedido'],
      indefinido:['pedÃ­','pediste','pidiÃ³','pedimos','pedisteis','pidieron'],
      futuro:['voy a pedir','vas a pedir','va a pedir','vamos a pedir','vais a pedir','van a pedir']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[2,5]}},

  {inf:'desayunar', en:'to have breakfast', zh:'åƒæ—©é¤', cat:'é¥®é£Ÿ', level:'A1',
    forms:{
      presente:['desayuno','desayunas','desayuna','desayunamos','desayunÃ¡is','desayunan'],
      perfecto:['he desayunado','has desayunado','ha desayunado','hemos desayunado','habÃ©is desayunado','han desayunado'],
      indefinido:['desayunÃ©','desayunaste','desayunÃ³','desayunamos','desayunasteis','desayunaron'],
      futuro:['voy a desayunar','vas a desayunar','va a desayunar','vamos a desayunar','vais a desayunar','van a desayunar']
    }, irregular:{}},

  {inf:'cenar', en:'to have dinner', zh:'åƒæ™šé¥­', cat:'é¥®é£Ÿ', level:'A1',
    forms:{
      presente:['ceno','cenas','cena','cenamos','cenÃ¡is','cenan'],
      perfecto:['he cenado','has cenado','ha cenado','hemos cenado','habÃ©is cenado','han cenado'],
      indefinido:['cenÃ©','cenaste','cenÃ³','cenamos','cenasteis','cenaron'],
      futuro:['voy a cenar','vas a cenar','va a cenar','vamos a cenar','vais a cenar','van a cenar']
    }, irregular:{}},

  // ---- è´­ç‰© ----
  {inf:'comprar', en:'to buy', zh:'ä¹°', cat:'è´­ç‰©', level:'A1',
    forms:{
      presente:['compro','compras','compra','compramos','comprÃ¡is','compran'],
      perfecto:['he comprado','has comprado','ha comprado','hemos comprado','habÃ©is comprado','han comprado'],
      indefinido:['comprÃ©','compraste','comprÃ³','compramos','comprasteis','compraron'],
      futuro:['voy a comprar','vas a comprar','va a comprar','vamos a comprar','vais a comprar','van a comprar']
    }, irregular:{}},

  {inf:'pagar', en:'to pay', zh:'ä»˜é’±', cat:'è´­ç‰©', level:'A1',
    forms:{
      presente:['pago','pagas','paga','pagamos','pagÃ¡is','pagan'],
      perfecto:['he pagado','has pagado','ha pagado','hemos pagado','habÃ©is pagado','han pagado'],
      indefinido:['paguÃ©','pagaste','pagÃ³','pagamos','pagasteis','pagaron'],
      futuro:['voy a pagar','vas a pagar','va a pagar','vamos a pagar','vais a pagar','van a pagar']
    }, irregular:{indefinido:[0]}},

  {inf:'buscar', en:'to look for', zh:'å¯»æ‰¾', cat:'è´­ç‰©', level:'A1',
    forms:{
      presente:['busco','buscas','busca','buscamos','buscÃ¡is','buscan'],
      perfecto:['he buscado','has buscado','ha buscado','hemos buscado','habÃ©is buscado','han buscado'],
      indefinido:['busquÃ©','buscaste','buscÃ³','buscamos','buscasteis','buscaron'],
      futuro:['voy a buscar','vas a buscar','va a buscar','vamos a buscar','vais a buscar','van a buscar']
    }, irregular:{indefinido:[0]}},

  {inf:'necesitar', en:'to need', zh:'éœ€è¦', cat:'è´­ç‰©', level:'A1',
    forms:{
      presente:['necesito','necesitas','necesita','necesitamos','necesitÃ¡is','necesitan'],
      perfecto:['he necesitado','has necesitado','ha necesitado','hemos necesitado','habÃ©is necesitado','han necesitado'],
      indefinido:['necesitÃ©','necesitaste','necesitÃ³','necesitamos','necesitasteis','necesitaron'],
      futuro:['voy a necesitar','vas a necesitar','va a necesitar','vamos a necesitar','vais a necesitar','van a necesitar']
    }, irregular:{}},

  {inf:'llevar', en:'to take / to carry', zh:'å¸¦èµ°/æ‹¿', cat:'è´­ç‰©', level:'A1',
    forms:{
      presente:['llevo','llevas','lleva','llevamos','llevÃ¡is','llevan'],
      perfecto:['he llevado','has llevado','ha llevado','hemos llevado','habÃ©is llevado','han llevado'],
      indefinido:['llevÃ©','llevaste','llevÃ³','llevamos','llevasteis','llevaron'],
      futuro:['voy a llevar','vas a llevar','va a llevar','vamos a llevar','vais a llevar','van a llevar']
    }, irregular:{}},

  // ---- èŒä¸š ----
  {inf:'trabajar', en:'to work', zh:'å·¥ä½œ', cat:'èŒä¸š', level:'A1',
    forms:{
      presente:['trabajo','trabajas','trabaja','trabajamos','trabajÃ¡is','trabajan'],
      perfecto:['he trabajado','has trabajado','ha trabajado','hemos trabajado','habÃ©is trabajado','han trabajado'],
      indefinido:['trabajÃ©','trabajaste','trabajÃ³','trabajamos','trabajasteis','trabajaron'],
      futuro:['voy a trabajar','vas a trabajar','va a trabajar','vamos a trabajar','vais a trabajar','van a trabajar']
    }, irregular:{}},

  {inf:'estudiar', en:'to study', zh:'å­¦ä¹ ', cat:'èŒä¸š', level:'A1',
    forms:{
      presente:['estudio','estudias','estudia','estudiamos','estudiÃ¡is','estudian'],
      perfecto:['he estudiado','has estudiado','ha estudiado','hemos estudiado','habÃ©is estudiado','han estudiado'],
      indefinido:['estudiÃ©','estudiaste','estudiÃ³','estudiamos','estudiasteis','estudiaron'],
      futuro:['voy a estudiar','vas a estudiar','va a estudiar','vamos a estudiar','vais a estudiar','van a estudiar']
    }, irregular:{}},

  {inf:'cobrar', en:'to earn / to charge', zh:'æ”¶è´¹/èµšé’±', cat:'èŒä¸š', level:'A1',
    forms:{
      presente:['cobro','cobras','cobra','cobramos','cobrÃ¡is','cobran'],
      perfecto:['he cobrado','has cobrado','ha cobrado','hemos cobrado','habÃ©is cobrado','han cobrado'],
      indefinido:['cobrÃ©','cobraste','cobrÃ³','cobramos','cobrasteis','cobraron'],
      futuro:['voy a cobrar','vas a cobrar','va a cobrar','vamos a cobrar','vais a cobrar','van a cobrar']
    }, irregular:{}},

  {inf:'ayudar', en:'to help', zh:'å¸®åŠ©', cat:'èŒä¸š', level:'A1',
    forms:{
      presente:['ayudo','ayudas','ayuda','ayudamos','ayudÃ¡is','ayudan'],
      perfecto:['he ayudado','has ayudado','ha ayudado','hemos ayudado','habÃ©is ayudado','han ayudado'],
      indefinido:['ayudÃ©','ayudaste','ayudÃ³','ayudamos','ayudasteis','ayudaron'],
      futuro:['voy a ayudar','vas a ayudar','va a ayudar','vamos a ayudar','vais a ayudar','van a ayudar']
    }, irregular:{}},

  // ---- çˆ±å¥½ ----
  {inf:'jugar', en:'to play', zh:'ç©/æ‰“ï¼ˆè¿åŠ¨ï¼‰', cat:'çˆ±å¥½', level:'A1',
    forms:{
      presente:['juego','juegas','juega','jugamos','jugÃ¡is','juegan'],
      perfecto:['he jugado','has jugado','ha jugado','hemos jugado','habÃ©is jugado','han jugado'],
      indefinido:['juguÃ©','jugaste','jugÃ³','jugamos','jugasteis','jugaron'],
      futuro:['voy a jugar','vas a jugar','va a jugar','vamos a jugar','vais a jugar','van a jugar']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[0]}},

  {inf:'bailar', en:'to dance', zh:'è·³èˆ', cat:'çˆ±å¥½', level:'A1',
    forms:{
      presente:['bailo','bailas','baila','bailamos','bailÃ¡is','bailan'],
      perfecto:['he bailado','has bailado','ha bailado','hemos bailado','habÃ©is bailado','han bailado'],
      indefinido:['bailÃ©','bailaste','bailÃ³','bailamos','bailasteis','bailaron'],
      futuro:['voy a bailar','vas a bailar','va a bailar','vamos a bailar','vais a bailar','van a bailar']
    }, irregular:{}},

  {inf:'cantar', en:'to sing', zh:'å”±æ­Œ', cat:'çˆ±å¥½', level:'A1',
    forms:{
      presente:['canto','cantas','canta','cantamos','cantÃ¡is','cantan'],
      perfecto:['he cantado','has cantado','ha cantado','hemos cantado','habÃ©is cantado','han cantado'],
      indefinido:['cantÃ©','cantaste','cantÃ³','cantamos','cantasteis','cantaron'],
      futuro:['voy a cantar','vas a cantar','va a cantar','vamos a cantar','vais a cantar','van a cantar']
    }, irregular:{}},

  {inf:'leer', en:'to read', zh:'é˜…è¯»', cat:'çˆ±å¥½', level:'A1',
    forms:{
      presente:['leo','lees','lee','leemos','leÃ©is','leen'],
      perfecto:['he leÃ­do','has leÃ­do','ha leÃ­do','hemos leÃ­do','habÃ©is leÃ­do','han leÃ­do'],
      indefinido:['leÃ­','leÃ­ste','leyÃ³','leÃ­mos','leÃ­steis','leyeron'],
      futuro:['voy a leer','vas a leer','va a leer','vamos a leer','vais a leer','van a leer']
    }, irregular:{presente:[0], indefinido:[2,5]}},

  {inf:'escuchar', en:'to listen', zh:'å¬', cat:'çˆ±å¥½', level:'A1',
    forms:{
      presente:['escucho','escuchas','escucha','escuchamos','escuchÃ¡is','escuchan'],
      perfecto:['he escuchado','has escuchado','ha escuchado','hemos escuchado','habÃ©is escuchado','han escuchado'],
      indefinido:['escuchÃ©','escuchaste','escuchÃ³','escuchamos','escuchasteis','escucharon'],
      futuro:['voy a escuchar','vas a escuchar','va a escuchar','vamos a escuchar','vais a escuchar','van a escuchar']
    }, irregular:{}},

  {inf:'viajar', en:'to travel', zh:'æ—…è¡Œ', cat:'çˆ±å¥½', level:'A1',
    forms:{
      presente:['viajo','viajas','viaja','viajamos','viajÃ¡is','viajan'],
      perfecto:['he viajado','has viajado','ha viajado','hemos viajado','habÃ©is viajado','han viajado'],
      indefinido:['viajÃ©','viajaste','viajÃ³','viajamos','viajasteis','viajaron'],
      futuro:['voy a viajar','vas a viajar','va a viajar','vamos a viajar','vais a viajar','van a viajar']
    }, irregular:{}},

  {inf:'dormir', en:'to sleep', zh:'ç¡è§‰', cat:'çˆ±å¥½', level:'A1',
    forms:{
      presente:['duermo','duermes','duerme','dormimos','dormÃ­s','duermen'],
      perfecto:['he dormido','has dormido','ha dormido','hemos dormido','habÃ©is dormido','han dormido'],
      indefinido:['dormÃ­','dormiste','durmiÃ³','dormimos','dormisteis','durmieron'],
      futuro:['voy a dormir','vas a dormir','va a dormir','vamos a dormir','vais a dormir','van a dormir']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[2,5]}},

  {inf:'descansar', en:'to rest', zh:'ä¼‘æ¯', cat:'çˆ±å¥½', level:'A1',
    forms:{
      presente:['descanso','descansas','descansa','descansamos','descansÃ¡is','descansan'],
      perfecto:['he descansado','has descansado','ha descansado','hemos descansado','habÃ©is descansado','han descansado'],
      indefinido:['descansÃ©','descansaste','descansÃ³','descansamos','descansasteis','descansaron'],
      futuro:['voy a descansar','vas a descansar','va a descansar','vamos a descansar','vais a descansar','van a descansar']
    }, irregular:{}},

  // ---- èº«ä½“/å¥åº· ----
  {inf:'sentirse', en:'to feel', zh:'æ„Ÿè§‰', cat:'èº«ä½“/å¥åº·', level:'A2',
    forms:{
      presente:['me siento','te sientes','se siente','nos sentimos','os sentÃ­s','se sienten'],
      perfecto:['me he sentido','te has sentido','se ha sentido','nos hemos sentido','os habÃ©is sentido','se han sentido'],
      indefinido:['me sentÃ­','te sentiste','se sintiÃ³','nos sentimos','os sentisteis','se sintieron'],
      futuro:['me voy a sentir','te vas a sentir','se va a sentir','nos vamos a sentir','os vais a sentir','se van a sentir']
    }, irregular:{presente:[0,1,2,4,5], indefinido:[2,5]}},

  {inf:'doler', en:'to hurt / to ache', zh:'ç–¼/ç—›', cat:'èº«ä½“/å¥åº·', level:'A1',
    forms:{
      presente:['me duele','te duele','le duele','nos duele','os duele','les duele'],
      perfecto:['me ha dolido','te ha dolido','le ha dolido','nos ha dolido','os ha dolido','les ha dolido'],
      indefinido:['me doliÃ³','te doliÃ³','le doliÃ³','nos doliÃ³','os doliÃ³','les doliÃ³'],
      futuro:['me va a doler','te va a doler','le va a doler','nos va a doler','os va a doler','les va a doler']
    }, irregular:{presente:[0,1,2,3,4,5]}},

  {inf:'encontrarse', en:'to feel / to be located', zh:'æ„Ÿè§‰/ä½äº', cat:'èº«ä½“/å¥åº·', level:'A2',
    forms:{
      presente:['me encuentro','te encuentras','se encuentra','nos encontramos','os encontrÃ¡is','se encuentran'],
      perfecto:['me he encontrado','te has encontrado','se ha encontrado','nos hemos encontrado','os habÃ©is encontrado','se han encontrado'],
      indefinido:['me encontrÃ©','te encontraste','se encontrÃ³','nos encontramos','os encontrasteis','se encontraron'],
      futuro:['me voy a encontrar','te vas a encontrar','se va a encontrar','nos vamos a encontrar','os vais a encontrar','se van a encontrar']
    }, irregular:{presente:[0,1,2,4,5]}},

  // ---- å­¦ä¹  ----
  {inf:'hablar', en:'to speak / to talk', zh:'è¯´/è®²è¯', cat:'å­¦ä¹ ', level:'A1',
    forms:{
      presente:['hablo','hablas','habla','hablamos','hablÃ¡is','hablan'],
      perfecto:['he hablado','has hablado','ha hablado','hemos hablado','habÃ©is hablado','han hablado'],
      indefinido:['hablÃ©','hablaste','hablÃ³','hablamos','hablasteis','hablaron'],
      futuro:['voy a hablar','vas a hablar','va a hablar','vamos a hablar','vais a hablar','van a hablar']
    }, irregular:{}},

  {inf:'escribir', en:'to write', zh:'å†™', cat:'å­¦ä¹ ', level:'A1',
    forms:{
      presente:['escribo','escribes','escribe','escribimos','escribÃ­s','escriben'],
      perfecto:['he escrito','has escrito','ha escrito','hemos escrito','habÃ©is escrito','han escrito'],
      indefinido:['escribÃ­','escribiste','escribiÃ³','escribimos','escribisteis','escribieron'],
      futuro:['voy a escribir','vas a escribir','va a escribir','vamos a escribir','vais a escribir','van a escribir']
    }, irregular:{}},

  {inf:'entender', en:'to understand', zh:'ç†è§£/å¬æ‡‚', cat:'å­¦ä¹ ', level:'A1',
    forms:{
      presente:['entiendo','entiendes','entiende','entendemos','entendÃ©is','entienden'],
      perfecto:['he entendido','has entendido','ha entendido','hemos entendido','habÃ©is entendido','han entendido'],
      indefinido:['entendÃ­','entendiste','entendiÃ³','entendimos','entendisteis','entendieron'],
      futuro:['voy a entender','vas a entender','va a entender','vamos a entender','vais a entender','van a entender']
    }, irregular:{presente:[0,1,2,4,5]}},

  {inf:'aprender', en:'to learn', zh:'å­¦/å­¦ä¼š', cat:'å­¦ä¹ ', level:'A1',
    forms:{
      presente:['aprendo','aprendes','aprende','aprendemos','aprendÃ©is','aprenden'],
      perfecto:['he aprendido','has aprendido','ha aprendido','hemos aprendido','habÃ©is aprendido','han aprendido'],
      indefinido:['aprendÃ­','aprendiste','aprendiÃ³','aprendimos','aprendisteis','aprendieron'],
      futuro:['voy a aprender','vas a aprender','va a aprender','vamos a aprender','vais a aprender','van a aprender']
    }, irregular:{}},

  {inf:'explicar', en:'to explain', zh:'è§£é‡Š', cat:'å­¦ä¹ ', level:'A1',
    forms:{
      presente:['explico','explicas','explica','explicamos','explicÃ¡is','explican'],
      perfecto:['he explicado','has explicado','ha explicado','hemos explicado','habÃ©is explicado','han explicado'],
      indefinido:['expliquÃ©','explicaste','explicÃ³','explicamos','explicasteis','explicaron'],
      futuro:['voy a explicar','vas a explicar','va a explicar','vamos a explicar','vais a explicar','van a explicar']
    }, irregular:{indefinido:[0]}},

  {inf:'preguntar', en:'to ask', zh:'é—®/è¯¢é—®', cat:'å­¦ä¹ ', level:'A1',
    forms:{
      presente:['pregunto','preguntas','pregunta','preguntamos','preguntÃ¡is','preguntan'],
      perfecto:['he preguntado','has preguntado','ha preguntado','hemos preguntado','habÃ©is preguntado','han preguntado'],
      indefinido:['preguntÃ©','preguntaste','preguntÃ³','preguntamos','preguntasteis','preguntaron'],
      futuro:['voy a preguntar','vas a preguntar','va a preguntar','vamos a preguntar','vais a preguntar','van a preguntar']
    }, irregular:{}},

  {inf:'recordar', en:'to remember', zh:'è®°å¾—', cat:'å­¦ä¹ ', level:'A2',
    forms:{
      presente:['recuerdo','recuerdas','recuerda','recordamos','recordÃ¡is','recuerdan'],
      perfecto:['he recordado','has recordado','ha recordado','hemos recordado','habÃ©is recordado','han recordado'],
      indefinido:['recordÃ©','recordaste','recordÃ³','recordamos','recordasteis','recordaron'],
      futuro:['voy a recordar','vas a recordar','va a recordar','vamos a recordar','vais a recordar','van a recordar']
    }, irregular:{presente:[0,1,2,4,5]}},

  // ---- ç§»åŠ¨/äº¤é€š ----
  {inf:'llegar', en:'to arrive', zh:'åˆ°è¾¾/åˆ°', cat:'ç§»åŠ¨/äº¤é€š', level:'A1',
    forms:{
      presente:['llego','llegas','llega','llegamos','llegÃ¡is','llegan'],
      perfecto:['he llegado','has llegado','ha llegado','hemos llegado','habÃ©is llegado','han llegado'],
      indefinido:['lleguÃ©','llegaste','llegÃ³','llegamos','llegasteis','llegaron'],
      futuro:['voy a llegar','vas a llegar','va a llegar','vamos a llegar','vais a llegar','van a llegar']
    }, irregular:{indefinido:[0]}},

  {inf:'salir', en:'to leave / to go out', zh:'å‡ºå»/ç¦»å¼€', cat:'ç§»åŠ¨/äº¤é€š', level:'A1',
    forms:{
      presente:['salgo','sales','sale','salimos','salÃ­s','salen'],
      perfecto:['he salido','has salido','ha salido','hemos salido','habÃ©is salido','han salido'],
      indefinido:['salÃ­','saliste','saliÃ³','salimos','salisteis','salieron'],
      futuro:['voy a salir','vas a salir','va a salir','vamos a salir','vais a salir','van a salir']
    }, irregular:{presente:[0]}},

  {inf:'volver', en:'to return / to come back', zh:'å›æ¥/è¿”å›', cat:'ç§»åŠ¨/äº¤é€š', level:'A1',
    forms:{
      presente:['vuelvo','vuelves','vuelve','volvemos','volvÃ©is','vuelven'],
      perfecto:['he vuelto','has vuelto','ha vuelto','hemos vuelto','habÃ©is vuelto','han vuelto'],
      indefinido:['volvÃ­','volviste','volviÃ³','volvimos','volvisteis','volvieron'],
      futuro:['voy a volver','vas a volver','va a volver','vamos a volver','vais a volver','van a volver']
    }, irregular:{presente:[0,1,2,4,5]}},

  {inf:'coger', en:'to take (transport)', zh:'ä¹˜å/æ‹¿', cat:'ç§»åŠ¨/äº¤é€š', level:'A1',
    forms:{
      presente:['cojo','coges','coge','cogemos','cogÃ©is','cogen'],
      perfecto:['he cogido','has cogido','ha cogido','hemos cogido','habÃ©is cogido','han cogido'],
      indefinido:['cogÃ­','cogiste','cogiÃ³','cogimos','cogisteis','cogieron'],
      futuro:['voy a coger','vas a coger','va a coger','vamos a coger','vais a coger','van a coger']
    }, irregular:{presente:[0]}},

  {inf:'conducir', en:'to drive', zh:'å¼€è½¦', cat:'ç§»åŠ¨/äº¤é€š', level:'A2',
    forms:{
      presente:['conduzco','conduces','conduce','conducimos','conducÃ­s','conducen'],
      perfecto:['he conducido','has conducido','ha conducido','hemos conducido','habÃ©is conducido','han conducido'],
      indefinido:['conduje','condujiste','condujo','condujimos','condujisteis','condujeron'],
      futuro:['voy a conducir','vas a conducir','va a conducir','vamos a conducir','vais a conducir','van a conducir'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','conduce','conduzca','conduzcamos','conducid','conduzcan']
    }, irregular:{presente:[0], indefinido:[0,1,2,3,4,5], imperativo:[1,2,3,5]}},

  // ---- REFLEXIVE VERBS (dedicated entries) ----
  {inf:'levantarse', en:'to get up', zh:'èµ·åºŠ', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['me levanto','te levantas','se levanta','nos levantamos','os levantÃ¡is','se levantan'],
      imperativo:['â€”','levÃ¡ntate','levÃ¡ntese','levantÃ©monos','levantaos','levÃ¡ntense']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'acostarse', en:'to go to bed', zh:'ç¡è§‰/èººä¸‹', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['me acuesto','te acuestas','se acuesta','nos acostamos','os acostÃ¡is','se acuestan'],
      imperativo:['â€”','acuÃ©state','acuÃ©stese','acostÃ©monos','acostaos','acuÃ©stense']
    }, irregular:{reflexivo:[0,1,2,4,5], imperativo:[1,2,3,5]}},

  {inf:'ducharse', en:'to shower', zh:'æ´—æ¾¡', cat:'èº«ä½“/å¥åº·', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['me ducho','te duchas','se ducha','nos duchamos','os duchÃ¡is','se duchan'],
      imperativo:['â€”','dÃºchate','dÃºchese','duchÃ©monos','duchaos','dÃºchense']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'vestirse', en:'to get dressed', zh:'ç©¿è¡£æœ', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['me visto','te vistes','se viste','nos vestimos','os vestÃ­s','se visten'],
      imperativo:['â€”','vÃ­stete','vÃ­stase','vistÃ¡monos','vestÃ­os','vÃ­stanse']
    }, irregular:{reflexivo:[0,1,2,4,5], imperativo:[1,2,3,5]}},

  {inf:'despertarse', en:'to wake up', zh:'é†’æ¥', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['me despierto','te despiertas','se despierta','nos despertamos','os despertÃ¡is','se despiertan'],
      imperativo:['â€”','despiÃ©rtate','despiÃ©rtese','despertÃ©monos','despertaos','despiÃ©rtense']
    }, irregular:{reflexivo:[0,1,2,4,5], imperativo:[1,2,3,5]}},

  {inf:'quedarse', en:'to stay / to remain', zh:'ç•™ä¸‹/ä¿æŒ', cat:'æ—¥å¸¸åŠ¨è¯', level:'A2',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['me quedo','te quedas','se queda','nos quedamos','os quedÃ¡is','se quedan'],
      imperativo:['â€”','quÃ©date','quÃ©dese','quedÃ©monos','quedaos','quÃ©dense']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'ponerse', en:'to put on (clothes) / to become', zh:'ç©¿ä¸Š/å˜å¾—', cat:'æ—¥å¸¸åŠ¨è¯', level:'A2',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['me pongo','te pones','se pone','nos ponemos','os ponÃ©is','se ponen'],
      imperativo:['â€”','ponte','pÃ³ngase','pongÃ¡monos','poneos','pÃ³nganse']
    }, irregular:{reflexivo:[0], imperativo:[1,2,3,5]}},

  {inf:'irse', en:'to leave / to go away', zh:'ç¦»å¼€/èµ°', cat:'ç§»åŠ¨/äº¤é€š', level:'A2',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['me voy','te vas','se va','nos vamos','os vais','se van'],
      imperativo:['â€”','vete','vÃ¡yase','vÃ¡monos','idos','vÃ¡yanse']
    }, irregular:{reflexivo:[0,1,2,3,4,5], imperativo:[1,2,3,5]}},

  // ---- IMPERATIVO-FOCUSED (common verbs with full imperativo forms) ----
  {inf:'hablar (imp.)', en:'to speak â€” imperative', zh:'è¯´è¯ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'å­¦ä¹ ', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','habla','hable','hablemos','hablad','hablen']
    }, irregular:{}},

  {inf:'comer (imp.)', en:'to eat â€” imperative', zh:'åƒï¼ˆå‘½ä»¤å¼ï¼‰', cat:'é¥®é£Ÿ', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','come','coma','comamos','comed','coman']
    }, irregular:{}},

  {inf:'ir (imp.)', en:'to go â€” imperative', zh:'å»ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','ve','vaya','vayamos','id','vayan']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'hacer (imp.)', en:'to do â€” imperative', zh:'åšï¼ˆå‘½ä»¤å¼ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','haz','haga','hagamos','haced','hagan']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'tener (imp.)', en:'to have â€” imperative', zh:'æœ‰ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','ten','tenga','tengamos','tened','tengan']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'ser (imp.)', en:'to be â€” imperative', zh:'æ˜¯ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','sÃ©','sea','seamos','sed','sean']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'venir (imp.)', en:'to come â€” imperative', zh:'æ¥ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A2',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','ven','venga','vengamos','venid','vengan']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'poner (imp.)', en:'to put â€” imperative', zh:'æ”¾ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A2',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','pon','ponga','pongamos','poned','pongan']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'decir (imp.)', en:'to say â€” imperative', zh:'è¯´ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'å­¦ä¹ ', level:'A2',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','di','diga','digamos','decid','digan']
    }, irregular:{imperativo:[1,2,3,5]}},

  {inf:'escuchar (imp.)', en:'to listen â€” imperative', zh:'å¬ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'å­¦ä¹ ', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','escucha','escuche','escuchemos','escuchad','escuchen']
    }, irregular:{}},

  {inf:'mirar (imp.)', en:'to look â€” imperative', zh:'çœ‹ï¼ˆå‘½ä»¤å¼ï¼‰', cat:'æ—¥å¸¸åŠ¨è¯', level:'A1',
    forms:{
      presente:['â€”','â€”','â€”','â€”','â€”','â€”'],
      perfecto:['â€”','â€”','â€”','â€”','â€”','â€”'],
      indefinido:['â€”','â€”','â€”','â€”','â€”','â€”'],
      futuro:['â€”','â€”','â€”','â€”','â€”','â€”'],
      reflexivo:['â€”','â€”','â€”','â€”','â€”','â€”'],
      imperativo:['â€”','mira','mire','miremos','mirad','miren']
    }, irregular:{}},
];

// ============================================================
// STATE
// ============================================================
let state = {
  category: 'å…¨éƒ¨',
  activeTenses: ['presente'],
  activePronouns: [0,1,2,3,4,5],
  verbLevels: ['A1', 'A2'],
  irregFilter: 'all',
  autoSpeak: true,
  speakAnswer: false,
  queue: [],
  idx: 0,
  revealed: false,
};

// ============================================================
// REFERENCE PAGE
// ============================================================
const REF_CONTENT = {
  zh: {
    header: 'å˜ä½é€»è¾‘',
    subtitle: 'A1/A2 é˜¶æ®µæ‰€æœ‰æ—¶æ€çš„è§„åˆ™å˜ä½ + ä¸è§„åˆ™è¯´æ˜',
    blocks: [
      {
        name: 'Presente de Indicativo', level: 'A1', cls: 'level-a1',
        desc: 'æè¿°ç°åœ¨æ­£åœ¨å‘ç”Ÿçš„äº‹ã€ä¹ æƒ¯æ€§åŠ¨ä½œã€æˆ–ä¸€èˆ¬äº‹å®ã€‚ä¸‰ç±»åŠ¨è¯ï¼ˆ-AR / -ER / -IRï¼‰å„æœ‰ä¸€å¥—è¯å°¾ã€‚',
        groups: [
          { title: '-AR (hablar)', rows: [['yo','-o'],['tÃº','-as'],['Ã©l/ella','-a'],['nosotros','-amos'],['vosotros','-Ã¡is'],['ellos','-an']] },
          { title: '-ER (comer)', rows: [['yo','-o'],['tÃº','-es'],['Ã©l/ella','-e'],['nosotros','-emos'],['vosotros','-Ã©is'],['ellos','-en']] },
          { title: '-IR (vivir)', rows: [['yo','-o'],['tÃº','-es'],['Ã©l/ella','-e'],['nosotros','-imos'],['vosotros','-Ã­s'],['ellos','-en']] },
        ],
        note: 'âš¡ å¸¸è§ä¸è§„åˆ™ï¼šserâ†’soy/eres/esï¼Œestarâ†’estoy/estÃ¡s/estÃ¡ï¼Œirâ†’voy/vas/vaï¼Œtenerâ†’tengo/tienesï¼Œhacerâ†’hagoï¼ˆyoï¼‰ï¼Œquererâ†’quiero/quieresï¼ˆeâ†’ieï¼‰ï¼Œpoderâ†’puedo/puedesï¼ˆoâ†’ueï¼‰',
      },
      {
        name: 'PretÃ©rito Perfecto Compuesto', level: 'A2', cls: 'level-a2',
        desc: 'è¡¨è¾¾ä¸ç°åœ¨æœ‰å…³è”çš„è¿‡å»è¡Œä¸ºï¼Œå¸¸ä¸ hoy / esta semana / ya / nunca / alguna vez è¿ç”¨ã€‚æ„æˆï¼šhaberï¼ˆç°åœ¨æ—¶ï¼‰+ è¿‡å»åˆ†è¯ã€‚',
        groups: [
          { title: 'haber (ç°åœ¨æ—¶)', rows: [['yo','he'],['tÃº','has'],['Ã©l/ella','ha'],['nosotros','hemos'],['vosotros','habÃ©is'],['ellos','han']] },
          { title: 'è§„åˆ™è¿‡å»åˆ†è¯', rows: [['-AR','-ado'],['-ER','-ido'],['-IR','-ido']], note: 'hablarâ†’hablado\ncomerâ†’comido\nvivirâ†’vivido' },
          { title: 'ä¸è§„åˆ™è¿‡å»åˆ†è¯', rows: [['hacer','hecho'],['ver','visto'],['decir','dicho'],['escribir','escrito'],['poner','puesto'],['volver','vuelto']], irreg: true },
        ],
        note: '',
      },
      {
        name: 'PretÃ©rito Indefinido', level: 'A2', cls: 'level-a2',
        desc: 'è¡¨è¾¾å·²å®Œæˆçš„ã€ä¸ç°åœ¨æ— å…³è”çš„è¿‡å»è¡Œä¸ºï¼Œå¸¸ä¸ ayer / la semana pasada / en 2020 / hace X aÃ±os è¿ç”¨ã€‚',
        groups: [
          { title: '-AR (hablar)', rows: [['yo','-Ã©'],['tÃº','-aste'],['Ã©l/ella','-Ã³'],['nosotros','-amos'],['vosotros','-asteis'],['ellos','-aron']] },
          { title: '-ER/-IR (comer/vivir)', rows: [['yo','-Ã­'],['tÃº','-iste'],['Ã©l/ella','-iÃ³'],['nosotros','-imos'],['vosotros','-isteis'],['ellos','-ieron']] },
          { title: 'å®Œå…¨ä¸è§„åˆ™', rows: [['ser/ir','fui/fue'],['tener','tuve'],['estar','estuve'],['hacer','hice'],['poder','pude'],['decir','dije']], irreg: true },
        ],
        note: '',
      },
      {
        name: 'Futuro PrÃ³ximo (ir a + inf)', level: 'A1', cls: 'level-a1',
        desc: 'è¡¨è¾¾è®¡åˆ’æˆ–å°†è¦å‘ç”Ÿçš„äº‹ã€‚æ„æˆï¼širï¼ˆç°åœ¨æ—¶ï¼‰+ a + åŠ¨è¯åŸå½¢ã€‚',
        groups: [
          { title: 'ir (ç°åœ¨æ—¶)', rows: [['yo','voy'],['tÃº','vas'],['Ã©l/ella','va'],['nosotros','vamos'],['vosotros','vais'],['ellos','van']], irreg: true },
          { title: 'ä¾‹å¥', span2: true, examples: ['Voy a comer â†’ æˆ‘è¦å»åƒ','Vas a estudiar â†’ ä½ è¦å»å­¦ä¹ ','Va a llover â†’ è¦ä¸‹é›¨äº†','Vamos a hablar â†’ æˆ‘ä»¬æ¥è¯´è¯´'] },
        ],
        note: '',
      },
      {
        name: 'Verbos Reflexivos', level: 'A1', cls: 'level-a1',
        desc: 'åèº«åŠ¨è¯è¡¨ç¤ºåŠ¨ä½œä½œç”¨äºä¸»è¯­è‡ªèº«ã€‚åœ¨åŠ¨è¯åŸå½¢å‰åŠ åèº«ä»£è¯ï¼ˆme/te/se/nos/os/seï¼‰ï¼Œå˜ä½åä»£è¯æ”¾åœ¨å˜ä½åŠ¨è¯å‰ã€‚',
        groups: [
          { title: 'åèº«ä»£è¯', rows: [['yo','me'],['tÃº','te'],['Ã©l/ella','se'],['nosotros','nos'],['vosotros','os'],['ellos','se']] },
          { title: 'levantarse (è§„åˆ™)', rows: [['yo','me levanto'],['tÃº','te levantas'],['Ã©l/ella','se levanta'],['nosotros','nos levantamos'],['vosotros','os levantÃ¡is'],['ellos','se levantan']] },
          { title: 'vestirse (ä¸è§„åˆ™ eâ†’i)', rows: [['yo','me visto'],['tÃº','te vistes'],['Ã©l/ella','se viste'],['nosotros','nos vestimos'],['vosotros','os vestÃ­s'],['ellos','se visten']], irreg: true },
        ],
        note: 'âš¡ å¸¸è§åèº«åŠ¨è¯ï¼šlevantarseï¼ˆèµ·åºŠï¼‰ã€acostarseï¼ˆç¡è§‰ï¼‰ã€ducharseï¼ˆæ´—æ¾¡ï¼‰ã€vestirseï¼ˆç©¿è¡£ï¼‰ã€despertarseï¼ˆé†’æ¥ï¼‰ã€llamarseï¼ˆå«åšï¼‰ã€sentirseï¼ˆæ„Ÿè§‰ï¼‰ã€ponerseï¼ˆç©¿ä¸Šï¼‰',
      },
      {
        name: 'Imperativo (Afirmativo)', level: 'A2', cls: 'level-a2',
        desc: 'å‘½ä»¤å¼ç”¨äºæŒ‡ä»¤ã€è¯·æ±‚ã€å»ºè®®ã€‚è‚¯å®šå‘½ä»¤å¼æ²¡æœ‰ yo å½¢å¼ã€‚tÃº å½¢å¼é€šå¸¸ç­‰äºç¬¬ä¸‰äººç§°å•æ•°ç°åœ¨æ—¶ï¼›vosotros å½¢å¼æŠŠåŸå½¢è¯å°¾ -r æ¢æˆ -dã€‚',
        groups: [
          { title: '-AR è§„åˆ™ (hablar)', rows: [['tÃº','habla'],['usted','hable'],['nosotros','hablemos'],['vosotros','hablad'],['ustedes','hablen']] },
          { title: '-ER/-IR è§„åˆ™ (comer)', rows: [['tÃº','come'],['usted','coma'],['nosotros','comamos'],['vosotros','comed'],['ustedes','coman']] },
          { title: 'ä¸è§„åˆ™ tÃº å½¢å¼', rows: [['ir','ve'],['hacer','haz'],['tener','ten'],['ser','sÃ©'],['poner','pon'],['decir','di'],['venir','ven']], irreg: true },
        ],
        note: 'âš¡ åèº«åŠ¨è¯å‘½ä»¤å¼ï¼šlevÃ¡ntateï¼ˆtÃºï¼‰ã€levantÃ©monosï¼ˆnosotrosï¼‰ã€levantaosï¼ˆvosotrosï¼‰ã€‚ä»£è¯é™„åŠ åœ¨åŠ¨è¯æœ«å°¾ã€‚',
      },
    ],
  },
  en: {
    header: 'Grammar Logic',
    subtitle: 'Conjugation rules for all A1/A2 tenses with irregular forms highlighted',
    blocks: [
      {
        name: 'Presente de Indicativo', level: 'A1', cls: 'level-a1',
        desc: 'Used for current actions, habits, and general facts. Three verb classes (-AR / -ER / -IR) each have their own set of endings.',
        groups: [
          { title: '-AR (hablar)', rows: [['yo','-o'],['tÃº','-as'],['Ã©l/ella','-a'],['nosotros','-amos'],['vosotros','-Ã¡is'],['ellos','-an']] },
          { title: '-ER (comer)', rows: [['yo','-o'],['tÃº','-es'],['Ã©l/ella','-e'],['nosotros','-emos'],['vosotros','-Ã©is'],['ellos','-en']] },
          { title: '-IR (vivir)', rows: [['yo','-o'],['tÃº','-es'],['Ã©l/ella','-e'],['nosotros','-imos'],['vosotros','-Ã­s'],['ellos','-en']] },
        ],
        note: 'âš¡ Common irregulars: serâ†’soy/eres/es, estarâ†’estoy/estÃ¡s/estÃ¡, irâ†’voy/vas/va, tenerâ†’tengo/tienes, hacerâ†’hago (yo only), quererâ†’quiero/quieres (eâ†’ie), poderâ†’puedo/puedes (oâ†’ue)',
      },
      {
        name: 'PretÃ©rito Perfecto Compuesto', level: 'A2', cls: 'level-a2',
        desc: 'Expresses past actions connected to the present. Common time markers: hoy / esta semana / ya / nunca / alguna vez. Formed with: haber (present) + past participle.',
        groups: [
          { title: 'haber (present)', rows: [['yo','he'],['tÃº','has'],['Ã©l/ella','ha'],['nosotros','hemos'],['vosotros','habÃ©is'],['ellos','han']] },
          { title: 'Regular participles', rows: [['-AR','-ado'],['-ER','-ido'],['-IR','-ido']], note: 'hablarâ†’hablado\ncomerâ†’comido\nvivirâ†’vivido' },
          { title: 'Irregular participles', rows: [['hacer','hecho'],['ver','visto'],['decir','dicho'],['escribir','escrito'],['poner','puesto'],['volver','vuelto']], irreg: true },
        ],
        note: '',
      },
      {
        name: 'PretÃ©rito Indefinido', level: 'A2', cls: 'level-a2',
        desc: 'Expresses completed past actions with no connection to the present. Common time markers: ayer / la semana pasada / en 2020 / hace X aÃ±os.',
        groups: [
          { title: '-AR (hablar)', rows: [['yo','-Ã©'],['tÃº','-aste'],['Ã©l/ella','-Ã³'],['nosotros','-amos'],['vosotros','-asteis'],['ellos','-aron']] },
          { title: '-ER/-IR (comer/vivir)', rows: [['yo','-Ã­'],['tÃº','-iste'],['Ã©l/ella','-iÃ³'],['nosotros','-imos'],['vosotros','-isteis'],['ellos','-ieron']] },
          { title: 'Fully irregular', rows: [['ser/ir','fui/fue'],['tener','tuve'],['estar','estuve'],['hacer','hice'],['poder','pude'],['decir','dije']], irreg: true },
        ],
        note: '',
      },
      {
        name: 'Futuro PrÃ³ximo (ir a + inf)', level: 'A1', cls: 'level-a1',
        desc: 'Expresses plans or intentions. Formed with: ir (present tense) + a + infinitive.',
        groups: [
          { title: 'ir (present)', rows: [['yo','voy'],['tÃº','vas'],['Ã©l/ella','va'],['nosotros','vamos'],['vosotros','vais'],['ellos','van']], irreg: true },
          { title: 'Examples', span2: true, examples: ['Voy a comer â†’ I am going to eat','Vas a estudiar â†’ You are going to study','Va a llover â†’ It is going to rain','Vamos a hablar â†’ We are going to talk'] },
        ],
        note: '',
      },
      {
        name: 'Verbos Reflexivos', level: 'A1', cls: 'level-a1',
        desc: 'Reflexive verbs express actions done to oneself. A reflexive pronoun (me/te/se/nos/os/se) is added and placed before the conjugated verb.',
        groups: [
          { title: 'Reflexive pronouns', rows: [['yo','me'],['tÃº','te'],['Ã©l/ella','se'],['nosotros','nos'],['vosotros','os'],['ellos','se']] },
          { title: 'levantarse (regular)', rows: [['yo','me levanto'],['tÃº','te levantas'],['Ã©l/ella','se levanta'],['nosotros','nos levantamos'],['vosotros','os levantÃ¡is'],['ellos','se levantan']] },
          { title: 'vestirse (irregular eâ†’i)', rows: [['yo','me visto'],['tÃº','te vistes'],['Ã©l/ella','se viste'],['nosotros','nos vestimos'],['vosotros','os vestÃ­s'],['ellos','se visten']], irreg: true },
        ],
        note: 'âš¡ Common reflexive verbs: levantarse (to get up), acostarse (to go to bed), ducharse (to shower), vestirse (to get dressed), despertarse (to wake up), llamarse (to be called), sentirse (to feel), ponerse (to put on)',
      },
      {
        name: 'Imperativo (Afirmativo)', level: 'A2', cls: 'level-a2',
        desc: 'The imperative is used for commands, requests, and suggestions. There is no yo form. The tÃº form usually matches the 3rd person singular present. The vosotros form replaces the final -r of the infinitive with -d.',
        groups: [
          { title: '-AR regular (hablar)', rows: [['tÃº','habla'],['usted','hable'],['nosotros','hablemos'],['vosotros','hablad'],['ustedes','hablen']] },
          { title: '-ER/-IR regular (comer)', rows: [['tÃº','come'],['usted','coma'],['nosotros','comamos'],['vosotros','comed'],['ustedes','coman']] },
          { title: 'Irregular tÃº forms', rows: [['ir','ve'],['hacer','haz'],['tener','ten'],['ser','sÃ©'],['poner','pon'],['decir','di'],['venir','ven']], irreg: true },
        ],
        note: 'âš¡ Reflexive imperatives: levÃ¡ntate (tÃº), levantÃ©monos (nosotros), levantaos (vosotros). The reflexive pronoun attaches to the end of the verb.',
      },
    ],
  },
};

function buildReference() {
  const data = REF_CONTENT[currentLang] || REF_CONTENT.en;
  const container = document.getElementById('refContainer');
  if (!container) return;

  const rowHTML = (rows, irreg) => rows.map(([p, e]) =>
    `<div class="ending-row"><span class="ending-pron">${p}</span><span class="ending-end${irreg?' irreg-ending':''}">${e}</span></div>`
  ).join('');

  const groupHTML = (g) => {
    if (g.span2) {
      return `<div class="ending-group" style="grid-column:span 2">
        <div class="ending-group-title">${g.title}</div>
        ${g.examples.map(e=>`<div style="font-size:13px;line-height:2.2">${e}</div>`).join('')}
      </div>`;
    }
    return `<div class="ending-group">
      <div class="ending-group-title">${g.title}</div>
      ${rowHTML(g.rows, g.irreg)}
      ${g.note ? `<div style="margin-top:8px;font-size:12px;color:var(--text-muted);white-space:pre-line">${g.note}</div>` : ''}
    </div>`;
  };

  const blockHTML = (b) => `
    <div class="tense-block">
      <div class="tense-block-header">
        <div class="tense-name">${b.name}</div>
        <div class="tense-level ${b.cls}">${b.level}</div>
      </div>
      <div class="tense-block-body">
        <div class="tense-desc">${b.desc}</div>
        <div class="endings-grid">${b.groups.map(groupHTML).join('')}</div>
        ${b.note ? `<div class="example-verb">${b.note}</div>` : ''}
      </div>
    </div>`;

  container.innerHTML = `
    <div>
      <div class="ref-header">${data.header}</div>
      <div class="ref-subtitle">${data.subtitle}</div>
    </div>
    ${data.blocks.map(blockHTML).join('')}
  `;
}

// ============================================================
// INIT
// ============================================================

function buildCategoryBar() {
  const bar = document.getElementById('categoryBar');
  const cats = t('cats');
  const internalCats = ['å…¨éƒ¨','æ—¥å¸¸åŠ¨è¯','é¥®é£Ÿ','è´­ç‰©','èŒä¸š','çˆ±å¥½','èº«ä½“/å¥åº·','å­¦ä¹ ','ç§»åŠ¨/äº¤é€š'];
  bar.innerHTML = internalCats.map((c, i) =>
    `<button class="cat-btn${c===state.category?' active':''}" data-cat="${c}" onclick="selectCategory('${c}')">${cats[i]}</button>`
  ).join('');
}

function buildTenseCheckboxes() {
  const container = document.getElementById('tenseCheckboxes');
  const tenseLabels = t('tense_labels');
  container.innerHTML = TENSES.map(tns => `
    <label class="checkbox-item">
      <input type="checkbox" ${state.activeTenses.includes(tns.id)?'checked':''} onchange="toggleTense('${tns.id}', this.checked)">
      <span class="checkbox-box"></span>
      <div>
        <div class="checkbox-label">${tns.name}</div>
        <div class="checkbox-sublabel">${tenseLabels[tns.id] || tns.label}</div>
      </div>
    </label>
  `).join('');
}

function buildPronounCheckboxes() {
  const container = document.getElementById('pronounCheckboxes');
  container.innerHTML = PRONOUNS.map((p, i) => `
    <label class="checkbox-item">
      <input type="checkbox" ${state.activePronouns.includes(i)?'checked':''} onchange="togglePronoun(${i}, this.checked)">
      <span class="checkbox-box"></span>
      <div><div class="checkbox-label">${p}</div></div>
    </label>
  `).join('');
}

function selectCategory(cat) {
  state.category = cat;
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.toggle('active', b.getAttribute('data-cat') === cat));
  buildQueue();
  renderCard();
}

function toggleTense(id, checked) {
  if (checked) { if (!state.activeTenses.includes(id)) state.activeTenses.push(id); }
  else { state.activeTenses = state.activeTenses.filter(t => t !== id); }
  if (state.activeTenses.length === 0) { state.activeTenses = [id]; buildTenseCheckboxes(); }
  buildQueue();
  renderCard();
}

function togglePronoun(idx, checked) {
  if (checked) { if (!state.activePronouns.includes(idx)) state.activePronouns.push(idx); }
  else { state.activePronouns = state.activePronouns.filter(i => i !== idx); }
  if (state.activePronouns.length === 0) { state.activePronouns = [idx]; buildPronounCheckboxes(); }
  buildQueue();
  renderCard();
}

function buildQueue() {
  let verbs = state.category === 'å…¨éƒ¨' ? VERBS : VERBS.filter(v => v.cat === state.category);
  verbs = verbs.filter(v => state.verbLevels.includes(v.level));

  const items = [];
  verbs.forEach(v => {
    state.activeTenses.forEach(t => {
      if (!v.forms[t]) return;
      state.activePronouns.forEach(pi => {
        const form = v.forms[t][pi];
        if (!form || form === 'â€”') return; // skip placeholder
        const isIrreg = (v.irregular[t] || []).includes(pi);
        if (state.irregFilter === 'regular' && isIrreg) return;
        if (state.irregFilter === 'irregular' && !isIrreg) return;
        items.push({ verb: v, tense: t, pronIdx: pi });
      });
    });
  });
  // Shuffle
  for (let i = items.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [items[i], items[j]] = [items[j], items[i]];
  }
  state.queue = items;
  state.idx = 0;
  state.revealed = false;
  updateProgress();
}

const IMPERATIVO_LABELS = ['(yo â€”)','tÃº','usted','nosotros','vosotros','ustedes'];
const REFLEXIVO_LABELS = ['yo','tÃº','Ã©l/ella','nosotros','vosotros','ellos/ellas'];

function renderCard() {
  if (state.queue.length === 0) {
    document.getElementById('infinitiveDisplay').textContent = t('no_cards');
    document.getElementById('meaningDisplay').textContent = t('no_cards_sub');
    document.getElementById('stageLabel').textContent = 'â€”';
    return;
  }
  const item = state.queue[state.idx % state.queue.length];
  const { verb, tense, pronIdx } = item;
  const form = verb.forms[tense][pronIdx];
  const isIrreg = (verb.irregular[tense] || []).includes(pronIdx);
  const tenseMeta = TENSES.find(t => t.id === tense);

  // Choose pronoun label based on tense
  let pronLabel;
  if (tense === 'imperativo') pronLabel = IMPERATIVO_LABELS[pronIdx];
  else pronLabel = PRONOUNS[pronIdx];

  // Meaning text â€” show zh only if current lang is zh
  const meaning = TRANSLATIONS[currentLang].show_zh
    ? `${item.verb.en} Â· ${item.verb.zh}`
    : item.verb.en;

  document.getElementById('stageLabel').textContent = tenseMeta ? tenseMeta.name : tense;
  document.getElementById('pronounBadge').textContent = pronLabel;
  document.getElementById('infinitiveDisplay').textContent = item.verb.inf;
  document.getElementById('meaningDisplay').textContent = meaning;
  const lvlBadge = document.getElementById('levelBadge');
  lvlBadge.textContent = item.verb.level;
  lvlBadge.className = 'card-level-badge ' + (item.verb.level === 'A1' ? 'level-a1' : 'level-a2');

  document.getElementById('answerPronoun').textContent = pronLabel;
  const conjEl = document.getElementById('conjugatedForm');
  conjEl.textContent = form;
  conjEl.className = 'conjugated-form' + (isIrreg ? ' irregular' : '');
  const irregTagEl = document.getElementById('irregTag');
  irregTagEl.style.display = isIrreg ? 'inline-block' : 'none';
  irregTagEl.textContent = t('irregular_tag');
  document.getElementById('answerMeaning').textContent = meaning;

  // Hide answer
  const card = document.getElementById('mainCard');
  card.classList.remove('revealed');
  state.revealed = false;

  // Animate
  card.classList.remove('animate-in');
  void card.offsetWidth;
  card.classList.add('animate-in');

  updateProgress();

  // Auto speak â€” only when on practice page
  if (state.autoSpeak && currentPage === 'practice') {
    setTimeout(() => speakText(item.verb.inf), 200);
  }
}

function handleCardClick() {
  if (!state.revealed) {
    document.getElementById('mainCard').classList.add('revealed');
    state.revealed = true;
    if (state.speakAnswer && currentPage === 'practice') {
      const item = state.queue[state.idx % state.queue.length];
      speakText(item.verb.forms[item.tense][item.pronIdx]);
    }
  } else {
    nextCard();
  }
}

function nextCard() {
  state.idx = (state.idx + 1) % state.queue.length;
  renderCard();
}

function prevCard() {
  state.idx = (state.idx - 1 + state.queue.length) % state.queue.length;
  renderCard();
}

function updateProgress() {
  const total = state.queue.length;
  const cur = state.idx + 1;
  const pct = total > 0 ? (cur / total) * 100 : 0;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressCount').textContent = `${cur} / ${total}`;
}

// ============================================================
// SPEECH
// ============================================================
function speakText(text) {
  if (!state.autoSpeak && !state.speakAnswer) return;
  try {
    const utt = new SpeechSynthesisUtterance(text);
    utt.lang = 'es-ES';
    utt.rate = 0.9;
    // Try to get a Google ES voice
    const voices = window.speechSynthesis.getVoices();
    const googleES = voices.find(v => v.lang.startsWith('es') && v.name.includes('Google'));
    const anyES = voices.find(v => v.lang.startsWith('es'));
    if (googleES) utt.voice = googleES;
    else if (anyES) utt.voice = anyES;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utt);
    const btn = document.getElementById('soundBtn');
    btn.classList.add('speaking');
    utt.onend = () => btn.classList.remove('speaking');
  } catch(e) {}
}

function speakCurrent() {
  const item = state.queue[state.idx % state.queue.length];
  if (!item) return;
  const text = state.revealed ? item.verb.forms[item.tense][item.pronIdx] : item.verb.inf;
  const utt = new SpeechSynthesisUtterance(text);
  utt.lang = 'es-ES';
  utt.rate = 0.9;
  const voices = window.speechSynthesis.getVoices();
  const googleES = voices.find(v => v.lang.startsWith('es') && v.name.includes('Google'));
  const anyES = voices.find(v => v.lang.startsWith('es'));
  if (googleES) utt.voice = googleES;
  else if (anyES) utt.voice = anyES;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utt);
}

// Load voices async
window.speechSynthesis.onvoiceschanged = () => {};

// ============================================================
// SETTINGS SYNC
// ============================================================
document.getElementById('toggleAutoSpeak').addEventListener('change', function() {
  state.autoSpeak = this.checked;
});
document.getElementById('toggleSpeakAnswer').addEventListener('change', function() {
  state.speakAnswer = this.checked;
});

function toggleVerbLevel(level, checked) {
  if (checked) { if (!state.verbLevels.includes(level)) state.verbLevels.push(level); }
  else { state.verbLevels = state.verbLevels.filter(l => l !== level); }
  if (state.verbLevels.length === 0) {
    state.verbLevels = [level];
    document.getElementById('level' + level).checked = true;
  }
  buildQueue(); renderCard();
}

function setIrregFilter(val) {
  state.irregFilter = val;
  ['all','regular','irregular'].forEach(v => {
    const el = document.getElementById('rb-' + v);
    if (el) {
      el.style.background = v === val ? 'var(--accent)' : '';
      el.style.borderColor = v === val ? 'var(--accent)' : '';
      el.innerHTML = v === val ? '<span style="color:white;font-size:11px;font-weight:700">âœ“</span>' : '';
    }
  });
  buildQueue(); renderCard();
}

// ============================================================
// PAGE NAV
// ============================================================
let currentPage = 'practice';

function showPage(id) {
  currentPage = id;
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
  document.querySelectorAll('.nav-tab').forEach((tab, i) => {
    tab.classList.toggle('active', ['practice','reference','settings'][i] === id);
  });
  // If returning to practice, speak the current card
  if (id === 'practice' && state.autoSpeak && state.queue.length > 0) {
    const item = state.queue[state.idx % state.queue.length];
    setTimeout(() => speakText(item.verb.inf), 150);
  }
}

// ============================================================
// KEYBOARD
// ============================================================
document.addEventListener('keydown', e => {
  if (e.key === ' ' || e.key === 'Enter') {
    e.preventDefault();
    handleCardClick();
  }
  if (e.key === 'ArrowRight') nextCard();
  if (e.key === 'ArrowLeft') prevCard();
  if (e.key === 's' || e.key === 'S') speakCurrent();
});

// ============================================================
// I18N â€” TRANSLATIONS
// ============================================================
const TRANSLATIONS = {
  zh: {
    nav_practice: 'ç»ƒä¹ ',
    nav_reference: 'è¯­æ³•é€»è¾‘',
    nav_settings: 'è®¾ç½®',
    settings_title: 'è®¾ç½®',
    settings_tenses: 'æ—¶æ€é€‰æ‹©',
    settings_pronouns: 'äººç§°ä»£è¯',
    settings_level: 'è¯æ±‡çº§åˆ«',
    settings_irreg: 'å˜åŒ–ç±»å‹',
    settings_speech: 'æœ—è¯»',
    settings_lang: 'ç•Œé¢è¯­è¨€',
    level_a1_sub: 'åŸºç¡€çº§åˆ«åŠ¨è¯',
    level_a2_sub: 'è¿›é˜¶çº§åˆ«åŠ¨è¯',
    irreg_all: 'å…¨éƒ¨',
    irreg_all_sub: 'è§„åˆ™ + ä¸è§„åˆ™',
    irreg_regular: 'åªç»ƒè§„åˆ™å˜åŒ–',
    irreg_regular_sub: 'è¯å°¾æŒ‰æ ‡å‡†è§„åˆ™å˜ä½çš„å½¢å¼',
    irreg_irregular: 'åªç»ƒä¸è§„åˆ™å˜åŒ–',
    irreg_irregular_sub: 'æœ‰ç‰¹æ®Šå˜ä½çš„å½¢å¼ï¼ˆæ©™è‰²æ ‡æ³¨ï¼‰',
    speech_auto: 'è‡ªåŠ¨æœ—è¯» Infinitivo',
    speech_auto_sub: 'ç¿»åˆ°æ–°å¡ç‰‡æ—¶è‡ªåŠ¨æœ—è¯»åŠ¨è¯åŸå½¢',
    speech_answer: 'æœ—è¯»å˜ä½ç»“æœ',
    speech_answer_sub: 'ç¿»å¼€ç­”æ¡ˆæ—¶è‡ªåŠ¨æœ—è¯»å˜ä½åçš„å½¢å¼',
    hint_reveal: 'ç‚¹å‡»æŸ¥çœ‹å˜ä½ Â· å†æ¬¡ç‚¹å‡»ä¸‹ä¸€é¢˜',
    hint_next: 'å†æ¬¡ç‚¹å‡»ä¸‹ä¸€é¢˜',
    irregular_tag: 'ä¸è§„åˆ™ âš¡',
    no_cards: 'æ— å¡ç‰‡',
    no_cards_sub: 'è¯·è°ƒæ•´ç±»åˆ«æˆ–è®¾ç½®',
    cat_all: 'å…¨éƒ¨',
    cats: ['å…¨éƒ¨','æ—¥å¸¸åŠ¨è¯','é¥®é£Ÿ','è´­ç‰©','èŒä¸š','çˆ±å¥½','èº«ä½“/å¥åº·','å­¦ä¹ ','ç§»åŠ¨/äº¤é€š'],
    tense_labels: {
      presente: 'ç°åœ¨æ—¶ (A1)',
      perfecto: 'è¿‘è¿‡å»æ—¶ (A2)',
      indefinido: 'ç®€å•è¿‡å»æ—¶ (A2)',
      futuro: 'è¿‘å°†æ¥ (A1)',
      reflexivo: 'åèº«åŠ¨è¯ç°åœ¨æ—¶ (A1)',
      imperativo: 'å‘½ä»¤å¼ (A2)',
    },
    meaning_sep: ' Â· ',   // separator between en and zh in card
    show_zh: true,
  },
  en: {
    nav_practice: 'Practice',
    nav_reference: 'Grammar',
    nav_settings: 'Settings',
    settings_title: 'Settings',
    settings_tenses: 'Tenses',
    settings_pronouns: 'Pronouns',
    settings_level: 'Vocabulary Level',
    settings_irreg: 'Conjugation Type',
    settings_speech: 'Audio',
    settings_lang: 'Interface Language',
    level_a1_sub: 'Beginner verbs',
    level_a2_sub: 'Elementary verbs',
    irreg_all: 'All',
    irreg_all_sub: 'Regular + irregular',
    irreg_regular: 'Regular only',
    irreg_regular_sub: 'Standard endings only',
    irreg_irregular: 'Irregular only',
    irreg_irregular_sub: 'Special forms (shown in orange)',
    speech_auto: 'Auto-read Infinitive',
    speech_auto_sub: 'Reads the infinitive when a new card appears',
    speech_answer: 'Read conjugated form',
    speech_answer_sub: 'Reads the answer when the card is flipped',
    hint_reveal: 'Tap to reveal Â· Tap again for next',
    hint_next: 'Tap again for next',
    irregular_tag: 'Irregular âš¡',
    no_cards: 'No cards',
    no_cards_sub: 'Adjust category or settings',
    cat_all: 'All',
    cats: ['All','Daily','Food & Drink','Shopping','Professions','Hobbies','Health','Studying','Transport'],
    tense_labels: {
      presente: 'Present tense (A1)',
      perfecto: 'Perfect tense (A2)',
      indefinido: 'Preterite (A2)',
      futuro: 'Near future (A1)',
      reflexivo: 'Reflexive present (A1)',
      imperativo: 'Imperative (A2)',
    },
    meaning_sep: ' Â· ',
    show_zh: false,
  },
};

let currentLang = 'en';

function t(key) {
  return TRANSLATIONS[currentLang][key] || TRANSLATIONS['zh'][key] || key;
}

function setLang(lang) {
  currentLang = lang;

  // Update settings language option buttons only
  ['zh','en'].forEach(l => {
    const optBtn = document.getElementById('lopt-' + l);
    if (optBtn) optBtn.classList.toggle('active', l === lang);
  });

  // Update all data-i18n elements
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    el.textContent = t(key);
  });

  // Update nav tabs
  document.getElementById('nav-practice').textContent = t('nav_practice');
  document.getElementById('nav-reference').textContent = t('nav_reference');
  document.getElementById('nav-settings').textContent = t('nav_settings');

  // Rebuild dynamic UI with translated text
  buildCategoryBar();
  buildTenseCheckboxes();
  buildPronounCheckboxes();
  buildReference();

  // Re-render card (updates meaning display language)
  renderCard();
}

function init() {
  buildQueue();
  setLang('en');
}

init();
</script>
</body>
</html>
